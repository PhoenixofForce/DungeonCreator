var app=function(){"use strict";function t(){}const e=t=>t;function n(t,e){for(const n in e)t[n]=e[n];return t}function o(t){return t()}function r(){return Object.create(null)}function i(t){t.forEach(o)}function s(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function u(t,e,n){t.$$.on_destroy.push(c(e,n))}function a(t,e,n,o){if(t){const r=d(t,e,n,o);return t[0](r)}}function d(t,e,o,r){return t[1]&&r?n(o.ctx.slice(),t[1](r(e))):o.ctx}function f(t,e,n,o,r,i,s){const l=function(t,e,n,o){if(t[2]&&o){const r=t[2](o(n));if(void 0===e.dirty)return r;if("object"==typeof r){const t=[],n=Math.max(e.dirty.length,r.length);for(let o=0;o<n;o+=1)t[o]=e.dirty[o]|r[o];return t}return e.dirty|r}return e.dirty}(e,o,r,i);if(l){const r=d(e,n,o,s);t.p(r,l)}}function h(t,e,n=e){return t.set(n),e}const p="undefined"!=typeof window;let m=p?()=>window.performance.now():()=>Date.now(),$=p?t=>requestAnimationFrame(t):t;const y=new Set;function g(t){y.forEach((e=>{e.c(t)||(y.delete(e),e.f())})),0!==y.size&&$(g)}function x(t,e){t.appendChild(e)}function b(t,e,n){t.insertBefore(e,n||null)}function w(t){t.parentNode.removeChild(t)}function v(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function k(t){return document.createElement(t)}function M(t){return document.createTextNode(t)}function _(){return M(" ")}function E(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function T(t){return function(e){return e.preventDefault(),t.call(this,e)}}function X(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Y(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function R(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}function S(t,e,n){t.classList[n?"add":"remove"](e)}function C(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}const F=new Set;let O,A=0;function j(t,e,n,o,r,i,s,l=0){const c=16.666/o;let u="{\n";for(let t=0;t<=1;t+=c){const o=e+(n-e)*i(t);u+=100*t+`%{${s(o,1-o)}}\n`}const a=u+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(a)}_${l}`,f=t.ownerDocument;F.add(f);const h=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(k("style")).sheet),p=f.__svelte_rules||(f.__svelte_rules={});p[d]||(p[d]=!0,h.insertRule(`@keyframes ${d} ${a}`,h.cssRules.length));const m=t.style.animation||"";return t.style.animation=`${m?`${m}, `:""}${d} ${o}ms linear ${r}ms 1 both`,A+=1,d}function L(t,e){const n=(t.style.animation||"").split(", "),o=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),r=n.length-o.length;r&&(t.style.animation=o.join(", "),A-=r,A||$((()=>{A||(F.forEach((t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}})),F.clear())})))}function P(t){O=t}function N(){if(!O)throw new Error("Function called outside component initialization");return O}function z(t){N().$$.on_mount.push(t)}function H(){const t=N();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=C(e,n);o.slice().forEach((e=>{e.call(t,r)}))}}}function D(t,e){N().$$.context.set(t,e)}function I(t){return N().$$.context.get(t)}const q=[],B=[],W=[],J=[],U=Promise.resolve();let G=!1;function K(t){W.push(t)}function Q(t){J.push(t)}let V=!1;const Z=new Set;function tt(){if(!V){V=!0;do{for(let t=0;t<q.length;t+=1){const e=q[t];P(e),et(e.$$)}for(P(null),q.length=0;B.length;)B.pop()();for(let t=0;t<W.length;t+=1){const e=W[t];Z.has(e)||(Z.add(e),e())}W.length=0}while(q.length);for(;J.length;)J.pop()();G=!1,V=!1,Z.clear()}}function et(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(K)}}let nt;function ot(t,e,n){t.dispatchEvent(C(`${e?"intro":"outro"}${n}`))}const rt=new Set;let it;function st(){it={r:0,c:[],p:it}}function lt(){it.r||i(it.c),it=it.p}function ct(t,e){t&&t.i&&(rt.delete(t),t.i(e))}function ut(t,e,n,o){if(t&&t.o){if(rt.has(t))return;rt.add(t),it.c.push((()=>{rt.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}const at={duration:0};function dt(n,o,r,l){let c=o(n,r),u=l?0:1,a=null,d=null,f=null;function h(){f&&L(n,f)}function p(t,e){const n=t.b-u;return e*=Math.abs(n),{a:u,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function x(o){const{delay:r=0,duration:s=300,easing:l=e,tick:x=t,css:b}=c||at,w={start:m()+r,b:o};o||(w.group=it,it.r+=1),a||d?d=w:(b&&(h(),f=j(n,u,o,s,r,l,b)),o&&x(0,1),a=p(w,s),K((()=>ot(n,o,"start"))),function(t){let e;0===y.size&&$(g),new Promise((n=>{y.add(e={c:t,f:n})}))}((t=>{if(d&&t>d.start&&(a=p(d,s),d=null,ot(n,a.b,"start"),b&&(h(),f=j(n,u,a.b,a.duration,0,l,c.css))),a)if(t>=a.end)x(u=a.b,1-u),ot(n,a.b,"end"),d||(a.b?h():--a.group.r||i(a.group.c)),a=null;else if(t>=a.start){const e=t-a.start;u=a.a+a.d*l(e/a.duration),x(u,1-u)}return!(!a&&!d)})))}return{run(t){s(c)?(nt||(nt=Promise.resolve(),nt.then((()=>{nt=null}))),nt).then((()=>{c=c(),x(t)})):x(t)},end(){h(),a=d=null}}}const ft="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ht(t,e,n){const o=t.$$.props[e];void 0!==o&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function pt(t){t&&t.c()}function mt(t,e,n){const{fragment:r,on_mount:l,on_destroy:c,after_update:u}=t.$$;r&&r.m(e,n),K((()=>{const e=l.map(o).filter(s);c?c.push(...e):i(e),t.$$.on_mount=[]})),u.forEach(K)}function $t(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function yt(t,e){-1===t.$$.dirty[0]&&(q.push(t),G||(G=!0,U.then(tt)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function gt(e,n,o,s,l,c,u=[-1]){const a=O;P(e);const d=n.props||{},f=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:r(),dirty:u,skip_bound:!1};let h=!1;if(f.ctx=o?o(e,d,((t,n,...o)=>{const r=o.length?o[0]:n;return f.ctx&&l(f.ctx[t],f.ctx[t]=r)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](r),h&&yt(e,t)),n})):[],f.update(),h=!0,i(f.before_update),f.fragment=!!s&&s(f.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);f.fragment&&f.fragment.l(t),t.forEach(w)}else f.fragment&&f.fragment.c();n.intro&&ct(e.$$.fragment),mt(e,n.target,n.anchor),tt()}P(a)}class xt{$destroy(){$t(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const bt=[];function wt(e,n=t){let o;const r=[];function i(t){if(l(e,t)&&(e=t,o)){const t=!bt.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),bt.push(n,e)}if(t){for(let t=0;t<bt.length;t+=2)bt[t][0](bt[t+1]);bt.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(s,l=t){const c=[s,l];return r.push(c),1===r.length&&(o=n(i)||t),s(e),()=>{const t=r.indexOf(c);-1!==t&&r.splice(t,1),0===r.length&&(o(),o=null)}}}}function vt(e,n,o){const r=!Array.isArray(e),l=r?[e]:e,u=n.length<2;return{subscribe:wt(o,(e=>{let o=!1;const a=[];let d=0,f=t;const h=()=>{if(d)return;f();const o=n(r?a[0]:a,e);u?e(o):f=s(o)?o:t},p=l.map(((t,e)=>c(t,(t=>{a[e]=t,d&=~(1<<e),o&&h()}),(()=>{d|=1<<e}))));return o=!0,h(),function(){i(p),f()}})).subscribe}}const kt=wt({rects:[{x:25,y:10,w:5,h:5}],doors:[]}),Mt=wt(0);let _t=wt({screenX:0,screenY:0,worldX:0,worldY:0,tileX:0,tileY:0,clickTileX:0,clickTileY:0,entered:!0,down:0});const Et=wt(window.innerWidth),Tt=wt(window.innerHeight),Xt=wt(window.devicePixelRatio),Yt=wt(),Rt=wt(),St=wt({dx:0,dy:0}),Ct=wt(0),Ft=wt(32),Ot=wt({background:"#0E0E0E",rooms:"#EEEEEE",lastFigureColors:[]}),At=function(t){const e=Object.keys(t);return vt(e.map((e=>t[e])),(t=>t.reduce(((t,n,o)=>(t[e[o]]=n,t)),{})))}({context:Yt,canvas:Rt,width:Et,height:Tt,pixelRatio:Xt,time:Ct}),jt=Symbol(),Lt=t=>{const e=I(jt),n={ready:!1,mounted:!1};"function"==typeof t?(n.render=t,n.height=0):t&&(t.render&&(n.render=t.render),t.setup&&(n.setup=t.setup),t.height&&(n.height=t.height)),e.add(n),z((()=>(n.mounted=!0,()=>{e.remove(n),n.mounted=!1})))};function Pt(t){let e,n,o=JSON.parse(JSON.stringify(t));for(let t in o.rects){let r=o.rects[t];(!e||e&&r.x>e)&&(e=r.x),(!n||n&&r.y>n)&&(n=r.y)}for(let t in o.rects){let r=o.rects[t];r.x-=e,r.y-=n}for(let t in o.doors){let r=o.doors[t];r.x-=e,r.y-=n}!function(t,e){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}("map.json",JSON.stringify(o))}function Nt(e){let n,o,r,s,l,c,u,a,d,f,h,p,m,$;return{c(){n=k("div"),o=k("button"),o.innerHTML='<img alt="move" src="https://icongr.am/feather/move.svg?size=24"/>',r=_(),s=k("button"),s.innerHTML='<img alt="edit" src="https://icongr.am/feather/edit-2.svg?size=24"/>',l=_(),c=k("button"),c.innerHTML='<img alt="delete" src="https://icongr.am/feather/delete.svg?size=24"/>',u=_(),a=k("button"),a.innerHTML='<img alt="upload file" src="https://icongr.am/feather/upload.svg?size=24"/>',d=_(),f=k("button"),f.innerHTML='<img alt="download" src="https://icongr.am/feather/download.svg?size=24"/>',h=_(),p=k("input"),X(o,"class","button icon-only svelte-1hjbl3a"),S(o,"success",0==e[1]),X(s,"class","button icon-only svelte-1hjbl3a"),S(s,"success",1==e[1]),X(c,"class","button icon-only svelte-1hjbl3a"),S(c,"success",2==e[1]),X(a,"class","button icon-only right svelte-1hjbl3a"),X(f,"class","button icon-only primary svelte-1hjbl3a"),X(n,"id","toolbar"),X(n,"class","is-full-width svelte-1hjbl3a"),X(p,"id","fileid"),X(p,"type","file"),X(p,"class","is-hidden")},m(t,i){b(t,n,i),x(n,o),x(n,r),x(n,s),x(n,l),x(n,c),x(n,u),x(n,a),x(n,d),x(n,f),b(t,h,i),b(t,p,i),m||($=[E(o,"click",e[4]),E(s,"click",e[5]),E(c,"click",e[6]),E(a,"click",zt),E(f,"click",e[3]),E(p,"change",e[7])],m=!0)},p(t,[e]){2&e&&S(o,"success",0==t[1]),2&e&&S(s,"success",1==t[1]),2&e&&S(c,"success",2==t[1])},i:t,o:t,d(t){t&&w(n),t&&w(h),t&&w(p),m=!1,i($)}}}function zt(){document.getElementById("fileid").click()}function Ht(t,e,n){let o,r,i;function s(t){h(Mt,o=t,o)}u(t,Mt,(t=>n(1,o=t))),u(t,kt,(t=>n(8,r=t)));return t.$$.update=()=>{if(1&t.$$.dirty&&i&&i[0]){!function(t){let e=new FileReader(t);e.onload=function(t){let n=JSON.parse(e.result),o=0,r=0;for(let t in n.rects){let e=n.rects[t];e.x<o&&(o=e.x),e.y<r&&(r=e.y)}o-=1,r-=1;for(let t in n.rects){let e=n.rects[t];e.x-=o,e.y-=r}for(let t in n.doors){let e=n.doors[t];e.x-=o,e.y-=r}kt.update((t=>n))},e.readAsText(t)}(i[0])}},[i,o,s,function(){Pt(r)},()=>s(0),()=>s(1),()=>s(2),function(){i=this.files,n(0,i)}]}class Dt extends xt{constructor(t){super(),gt(this,t,Ht,Nt,l,{})}}const{window:It}=ft;function qt(t){let e,n,o,r,s,l,c,u;const d=t[12].default,h=a(d,t,t[11],null);return{c(){e=k("canvas"),r=_(),h&&h.c(),s=_(),X(e,"width",n=t[3]*t[1]),X(e,"height",o=t[4]*t[1]),R(e,"width",t[3]+"px"),R(e,"height",t[4]+"px")},m(n,o){b(n,e,o),t[15](e),b(n,r,o),h&&h.m(n,o),b(n,s,o),l=!0,c||(u=[E(It,"resize",t[5],{passive:!0}),E(e,"mousemove",t[7]),E(e,"mousedown",t[8]),E(e,"mouseup",t[6]),E(e,"mouseenter",t[13]),E(e,"mouseleave",t[14]),E(document.body,"contextmenu",T(t[16]))],c=!0)},p(t,[r]){(!l||10&r&&n!==(n=t[3]*t[1]))&&X(e,"width",n),(!l||18&r&&o!==(o=t[4]*t[1]))&&X(e,"height",o),(!l||8&r)&&R(e,"width",t[3]+"px"),(!l||16&r)&&R(e,"height",t[4]+"px"),h&&h.p&&2048&r&&f(h,d,t,t[11],r,null,null)},i(t){l||(ct(h,t),l=!0)},o(t){ut(h,t),l=!1},d(n){n&&w(e),t[15](null),n&&w(r),h&&h.d(n),n&&w(s),c=!1,i(u)}}}function Bt(t,e,n){let o,r,i,s,l,c,a,d,f;u(t,At,(t=>n(20,o=t))),u(t,St,(t=>n(21,r=t))),u(t,Xt,(t=>n(1,i=t))),u(t,_t,(t=>n(2,s=t))),u(t,Mt,(t=>n(22,l=t))),u(t,kt,(t=>n(23,c=t))),u(t,Ft,(t=>n(24,a=t))),u(t,Et,(t=>n(3,d=t))),u(t,Tt,(t=>n(4,f=t)));let p,m,$,{$$slots:y={},$$scope:g}=e,{killLoopOnError:x=!0}=e,{attributes:b={}}=e,w=[];z((()=>(m=p.getContext("2d",b),Rt.set(p),Yt.set(m),function(t){let e=0,n=performance.now();return function o(){$=requestAnimationFrame(o);const r=performance.now(),i=(r-n)/1e3;n=r,e+=i,t(e,i)}(),()=>{cancelAnimationFrame($)}}(((t,e)=>{Ct.set(t),function(t){m.save(),m.translate(-r.dx,-r.dy),m.scale(i,i),w.forEach((e=>{try{e.mounted&&e.ready&&e.render&&e.render(o,t)}catch(t){console.error(t),x&&(cancelAnimationFrame($),console.warn("Animation loop stopped due to an error"))}})),m.restore()}(e)}))))),D(jt,{add(t){if(this.remove(t),w.push(t),t.setup){let e=t.setup(o);e&&e.then}t.ready=!0,w.sort(((t,e)=>t.height-e.height))},remove(t){const e=w.indexOf(t);e>=0&&w.splice(e,1)}});const v=H();return t.$$set=t=>{"killLoopOnError"in t&&n(9,x=t.killLoopOnError),"attributes"in t&&n(10,b=t.attributes),"$$scope"in t&&n(11,g=t.$$scope)},[p,i,s,d,f,function(){Et.set(window.innerWidth),Tt.set(window.innerHeight),Xt.set(window.devicePixelRatio)},function(t){h(_t,s.down=!1,s);let e={x:s.worldX,y:s.worldY,tileX:s.tileX,tileY:s.tileY};if(1===l){let n=c.rects.findIndex((t=>e.tileX>=t.x&&e.tileX<t.x+t.w&&e.tileY>=t.y&&e.tileY<=t.y+t.h)),o=c.doors.findIndex((t=>Math.floor(e.tileX)==t.x&&Math.floor(e.tileY)==t.y));if(n>=0&&o<0)h(kt,c.rects[n].rotunda=!c.rects[n].rotunda,c);else if(o>=0){let e=c.doors[o];if(2===t.button){let t=-e.dir.y,n=e.dir.x;e.dir={x:t,y:n}}else 0===t.button&&(e.type=e.type%8+1)}else{let t=Math.floor(s.tileX),e=Math.floor(s.clickTileX),n=Math.floor(s.tileY),o=Math.floor(s.clickTileY),r={x:Math.min(t,e),y:Math.min(n,o),w:Math.max(t,e)-Math.min(t,e)+1,h:Math.max(n,o)-Math.min(n,o)+1};1===r.h&&r.w>1?(r.x+=1,r.w-=2,c.rects.push({x:r.x-1,y:r.y,w:1,h:1}),c.rects.push({x:r.x+r.w,y:r.y,w:1,h:1}),c.doors.push({x:r.x-1,y:r.y,dir:{x:1,y:0},type:1}),c.doors.push({x:r.x+r.w,y:r.y,dir:{x:1,y:0},type:1})):1===r.w&&r.h>1?(r.y+=1,r.h-=2,c.rects.push({x:r.x,y:r.y-1,w:1,h:1}),c.rects.push({x:r.x,y:r.y+r.h,w:1,h:1}),c.doors.push({x:r.x,y:r.y-1,dir:{x:0,y:1},type:1}),c.doors.push({x:r.x,y:r.y+r.h,dir:{x:0,y:1},type:1})):1===r.w&&1===r.h&&c.doors.push({x:r.x,y:r.y,dir:{x:0,y:1},type:0}),c.rects.push(r),kt.set(c)}}else if(2===l){let t=c.rects.findIndex((t=>e.tileX>=t.x&&e.tileX<t.x+t.w&&e.tileY>=t.y&&e.tileY<=t.y+t.h)),n=c.doors.findIndex((t=>Math.floor(e.tileX)==t.x&&Math.floor(e.tileY)==t.y));t>=0&&c.rects.splice(t,1),n>=0&&c.doors.splice(n,1),kt.set(c)}},function(t){s.entered&&(s.down&&0==l&&h(St,r={dx:r.dx+(s.screenX-t.x)*i,dy:r.dy+(s.screenY-t.y)*i},r),h(_t,s.screenX=t.x,s),h(_t,s.screenY=t.y,s),h(_t,s.worldX=t.x+r.dx/i,s),h(_t,s.worldY=t.y+r.dy/i,s),h(_t,s.tileX=s.worldX/a,s),h(_t,s.tileY=s.worldY/a,s))},function(t){h(_t,s.down=!0,s),h(_t,s.clickTileX=s.tileX,s),h(_t,s.clickTileY=s.tileY,s),0===t.button&&v("down",t)},x,b,g,y,()=>h(_t,s.entered=!0,s),()=>h(_t,s.entered=!1,s),function(t){B[t?"unshift":"push"]((()=>{p=t,n(0,p)}))},()=>console.log("")]}class Wt extends xt{constructor(t){super(),gt(this,t,Bt,qt,l,{killLoopOnError:9,attributes:10})}}function Jt(t){let e;const n=t[2].default,o=a(n,t,t[1],null);return{c(){o&&o.c()},m(t,n){o&&o.m(t,n),e=!0},p(t,[e]){o&&o.p&&2&e&&f(o,n,t,t[1],e,null,null)},i(t){e||(ct(o,t),e=!0)},o(t){ut(o,t),e=!1},d(t){o&&o.d(t)}}}function Ut(t,e,n){let o,r,i,s;u(t,Ot,(t=>n(3,o=t))),u(t,Xt,(t=>n(4,r=t))),u(t,St,(t=>n(5,i=t))),u(t,Ft,(t=>n(6,s=t)));let{$$slots:l={},$$scope:c}=e,{color:a=o.background+"6"}=e;return Lt({render:t=>{const{context:e,width:n,height:o}=t;e.save();let l=r,c=i.dx/l,u=i.dy/l,d=n,f=o,h=c/s;h=h<0?Math.floor(h):Math.ceil(h);let p=u/s;p=p<0?Math.floor(p):Math.ceil(p);for(let t=Math.min(0,h);t<Math.max(0,h)+d/s;t++)e.beginPath(),e.strokeStyle=a,e.moveTo(t*s,u),e.lineTo(t*s,f+u),e.stroke();for(let t=Math.min(0,p);t<Math.max(0,p)+f/s;t++)e.beginPath(),e.strokeStyle=a,e.moveTo(c,t*s),e.lineTo(c+d,t*s),e.stroke();e.restore()},height:3}),t.$$set=t=>{"color"in t&&n(0,a=t.color),"$$scope"in t&&n(1,c=t.$$scope)},[a,c,l]}class Gt extends xt{constructor(t){super(),gt(this,t,Ut,Jt,l,{color:0})}}function Kt(t){let e;const n=t[1].default,o=a(n,t,t[0],null);return{c(){o&&o.c()},m(t,n){o&&o.m(t,n),e=!0},p(t,[e]){o&&o.p&&1&e&&f(o,n,t,t[0],e,null,null)},i(t){e||(ct(o,t),e=!0)},o(t){ut(o,t),e=!1},d(t){o&&o.d(t)}}}function Qt(t,e,n){let o,r,i;u(t,Ot,(t=>n(2,o=t))),u(t,Xt,(t=>n(3,r=t))),u(t,St,(t=>n(4,i=t)));let{$$slots:s={},$$scope:l}=e,c=o.background+"F";return Lt((t=>{const{context:e,width:n,height:o}=t;e.save();let s=r;e.clearRect(i.dx/s,i.dy/s,n,o),c&&(e.fillStyle=c,e.fillRect(i.dx/s,i.dy/r,n,o)),e.restore()})),t.$$set=t=>{"$$scope"in t&&n(0,l=t.$$scope)},[l,s]}class Vt extends xt{constructor(t){super(),gt(this,t,Qt,Kt,l,{})}}function Zt(t,e,n){let o,r;u(t,Ft,(t=>n(1,o=t))),u(t,Ot,(t=>n(2,r=t)));let{dimension:i}=e;return Lt({render:(t,e)=>{const{context:n,width:s,height:l}=t;if(n.save(),i){let t=i.x*o,e=i.y*o,s=i.w*o,l=i.h*o;i.rotunda?(n.beginPath(),n.fillStyle=r.rooms,n.ellipse(t+s/2,e+l/2,s/2,l/2,0,0,2*Math.PI),n.closePath(),n.fill(),n.beginPath()):(n.fillStyle=r.rooms,n.fillRect(t,e,s,l))}n.restore()},height:1}),t.$$set=t=>{"dimension"in t&&n(0,i=t.dimension)},[i]}class te extends xt{constructor(t){super(),gt(this,t,Zt,null,l,{dimension:0})}}function ee(t,e,n){let o;u(t,Ft,(t=>n(2,o=t)));let{color:r="#F8F8F4"}=e,{dimension:i}=e;return Lt({render:(t,e)=>{const{context:n,width:r,height:s}=t;n.save(),i&&(n.strokeStyle="#FF0",n.lineWidth=3,n.strokeRect(i.x*o,i.y*o,i.w*o,i.h*o),n.lineWidth=1),n.restore()},height:4}),t.$$set=t=>{"color"in t&&n(0,r=t.color),"dimension"in t&&n(1,i=t.dimension)},[r,i]}class ne extends xt{constructor(t){super(),gt(this,t,ee,null,l,{color:0,dimension:1})}}function oe(t,e,n){let o,r;u(t,Ot,(t=>n(1,o=t))),u(t,Ft,(t=>n(2,r=t)));let{dimension:i}=e;function s(t){t.fillStyle=o.background;let e=i.x*r,n=i.y*r,s=r,l=r;1==Math.abs(i.dir.y)?(l/=2,n+=l/2,s=r/8):(s/=2,e+=s/2,l=r/8),t.fillRect(e,n,s,l),1==Math.abs(i.dir.y)?e+=r-s:n+=r-l,t.fillRect(e,n,s,l)}function l(t,e){t.strokeStyle=o.background;let n=i.x*r,s=i.y*r,l=r,c=r;1==e?(1==Math.abs(i.dir.y)?(c/=4,s+=1.5*c):(l/=4,n+=1.5*l),t.strokeRect(n,s,l,c)):5==e&&(1==Math.abs(i.dir.y)?(c/=4,s+=1.5*c,l/=2):(l/=4,n+=1.5*l,c/=2),t.strokeRect(n,s,l,c),1==Math.abs(i.dir.y)?n+=l:s+=c,t.strokeRect(n,s,l,c))}function c(t){t.fillStyle=o.background;let e=i.x*r,n=i.y*r,s=.8*r,l=r/5;if(1==Math.abs(i.dir.x)){-1==i.dir.x&&(e+=r,l*=-1);for(let o=0;o<4;o++)e+=l,t.moveTo(e,n+(r-s)/2),t.lineTo(e,n+(r-s)/2+s),s*=.8}else if(1==Math.abs(i.dir.y)){-1==i.dir.y&&(n+=r,l*=-1);for(let o=0;o<4;o++)n+=l,t.moveTo(e+(r-s)/2,n),t.lineTo(e+(r-s)/2+s,n),s*=.8}t.stroke()}return Lt({render:(t,e)=>{const{context:n,width:u,height:a}=t;n.save(),i&&i.type>0&&(1==i.type?(s(n),l(n,1)):2==i.type?s(n):3==i.type?c(n):4==i.type||(5==i.type?(s(n),l(n,5)):6==i.type?function(t){t.fillStyle=o.background;let e=i.x*r,n=i.y*r,s=r,l=r;1==Math.abs(i.dir.y)?(l/=2,-1==i.dir.y&&(n+=l)):(s/=2,-1==i.dir.x&&(e+=s));t.fillRect(e,n,s,l)}(n):7==i.type?(s(n),l(n,1)):8==i.type&&c(n))),n.restore()},height:2}),t.$$set=t=>{"dimension"in t&&n(0,i=t.dimension)},[i]}class re extends xt{constructor(t){super(),gt(this,t,oe,null,l,{dimension:0})}}function ie(t,e,n){let o,r,i,s;u(t,Ot,(t=>n(0,o=t))),u(t,_t,(t=>n(1,r=t))),u(t,Mt,(t=>n(2,i=t))),u(t,Ft,(t=>n(3,s=t)));let l=o.rooms+"";return Lt({render:(t,e)=>{const{context:n,width:o,height:c}=t;if(n.save(),r.entered&&r.down&&1===i){console.log(i+" "+r.entered+" "+r.down);let t=Math.floor(r.clickTileX),e=Math.floor(r.clickTileY),o=Math.floor(r.tileX),c=Math.floor(r.tileY),u=Math.min(t,o),a=Math.min(e,c),d=Math.max(t,o)+1,f=Math.max(e,c)+1;n.fillStyle=l,n.fillRect(u*s,a*s,(d-u)*s,(f-a)*s)}n.restore()},height:2}),[]}class se extends xt{constructor(t){super(),gt(this,t,ie,null,l,{})}}function le(t,e,n){const o=t.slice();return o[6]=e[n],o[7]=e,o[8]=n,o}function ce(t,e,n){const o=t.slice();return o[6]=e[n],o}function ue(t){let e,n;return e=new te({props:{dimension:t[6]}}),{c(){pt(e.$$.fragment)},m(t,o){mt(e,t,o),n=!0},p(t,n){const o={};4&n&&(o.dimension=t[6]),e.$set(o)},i(t){n||(ct(e.$$.fragment,t),n=!0)},o(t){ut(e.$$.fragment,t),n=!1},d(t){$t(e,t)}}}function ae(t){let e,n,o;function r(e){t[4].call(null,e,t[6],t[7],t[8])}let i={};return void 0!==t[6]&&(i.dimension=t[6]),e=new re({props:i}),B.push((()=>ht(e,"dimension",r))),{c(){pt(e.$$.fragment)},m(t,n){mt(e,t,n),o=!0},p(o,r){t=o;const i={};!n&&4&r&&(n=!0,i.dimension=t[6],Q((()=>n=!1))),e.$set(i)},i(t){o||(ct(e.$$.fragment,t),o=!0)},o(t){ut(e.$$.fragment,t),o=!1},d(t){$t(e,t)}}}function de(t){let e,n,o;function r(e){t[5].call(null,e)}let i={};return void 0!==t[0]&&(i.dimension=t[0]),e=new ne({props:i}),B.push((()=>ht(e,"dimension",r))),{c(){pt(e.$$.fragment)},m(t,n){mt(e,t,n),o=!0},p(t,o){const r={};!n&&1&o&&(n=!0,r.dimension=t[0],Q((()=>n=!1))),e.$set(r)},i(t){o||(ct(e.$$.fragment,t),o=!0)},o(t){ut(e.$$.fragment,t),o=!1},d(t){$t(e,t)}}}function fe(t){let e,n,o,r,i,s,l,c,u;e=new Vt({});let a=t[2].rects,d=[];for(let e=0;e<a.length;e+=1)d[e]=ue(ce(t,a,e));const f=t=>ut(d[t],1,1,(()=>{d[t]=null}));let h=t[2].doors,p=[];for(let e=0;e<h.length;e+=1)p[e]=ae(le(t,h,e));const m=t=>ut(p[t],1,1,(()=>{p[t]=null}));i=new Gt({});let $=t[1].entered&&de(t);return c=new se({}),{c(){pt(e.$$.fragment),n=_();for(let t=0;t<d.length;t+=1)d[t].c();o=_();for(let t=0;t<p.length;t+=1)p[t].c();r=_(),pt(i.$$.fragment),s=_(),$&&$.c(),l=_(),pt(c.$$.fragment)},m(t,a){mt(e,t,a),b(t,n,a);for(let e=0;e<d.length;e+=1)d[e].m(t,a);b(t,o,a);for(let e=0;e<p.length;e+=1)p[e].m(t,a);b(t,r,a),mt(i,t,a),b(t,s,a),$&&$.m(t,a),b(t,l,a),mt(c,t,a),u=!0},p(t,n){const i={};if(2048&n&&(i.$$scope={dirty:n,ctx:t}),e.$set(i),4&n){let e;for(a=t[2].rects,e=0;e<a.length;e+=1){const r=ce(t,a,e);d[e]?(d[e].p(r,n),ct(d[e],1)):(d[e]=ue(r),d[e].c(),ct(d[e],1),d[e].m(o.parentNode,o))}for(st(),e=a.length;e<d.length;e+=1)f(e);lt()}if(4&n){let e;for(h=t[2].doors,e=0;e<h.length;e+=1){const o=le(t,h,e);p[e]?(p[e].p(o,n),ct(p[e],1)):(p[e]=ae(o),p[e].c(),ct(p[e],1),p[e].m(r.parentNode,r))}for(st(),e=h.length;e<p.length;e+=1)m(e);lt()}t[1].entered?$?($.p(t,n),2&n&&ct($,1)):($=de(t),$.c(),ct($,1),$.m(l.parentNode,l)):$&&(st(),ut($,1,1,(()=>{$=null})),lt())},i(t){if(!u){ct(e.$$.fragment,t);for(let t=0;t<a.length;t+=1)ct(d[t]);for(let t=0;t<h.length;t+=1)ct(p[t]);ct(i.$$.fragment,t),ct($),ct(c.$$.fragment,t),u=!0}},o(t){ut(e.$$.fragment,t),d=d.filter(Boolean);for(let t=0;t<d.length;t+=1)ut(d[t]);p=p.filter(Boolean);for(let t=0;t<p.length;t+=1)ut(p[t]);ut(i.$$.fragment,t),ut($),ut(c.$$.fragment,t),u=!1},d(t){$t(e,t),t&&w(n),v(d,t),t&&w(o),v(p,t),t&&w(r),$t(i,t),t&&w(s),$&&$.d(t),t&&w(l),$t(c,t)}}}function he(t){let e,n,o,r,i,s,l;return e=new Dt({}),r=new Wt({props:{$$slots:{default:[fe]},$$scope:{ctx:t}}}),{c(){pt(e.$$.fragment),n=_(),o=k("div"),pt(r.$$.fragment),X(o,"id","canvasDisplay"),X(o,"class","svelte-qo5sc3")},m(c,u){mt(e,c,u),b(c,n,u),b(c,o,u),mt(r,o,null),i=!0,s||(l=E(o,"mousemove",t[3]),s=!0)},p(t,[e]){const n={};2055&e&&(n.$$scope={dirty:e,ctx:t}),r.$set(n)},i(t){i||(ct(e.$$.fragment,t),ct(r.$$.fragment,t),i=!0)},o(t){ut(e.$$.fragment,t),ut(r.$$.fragment,t),i=!1},d(t){$t(e,t),t&&w(n),t&&w(o),$t(r),s=!1,l()}}}function pe(t,e,n){let o,r;u(t,_t,(t=>n(1,o=t))),u(t,kt,(t=>n(2,r=t)));let i={x:0,y:0,w:1,h:1};return[i,o,r,function(t){let e={x:o.tileX,y:o.tileY};n(0,i=r.rects.find((t=>e.x>=t.x&&e.x<t.x+t.w&&e.y>=t.y&&e.y<=t.y+t.h))),i||n(0,i={x:Math.floor(e.x),y:Math.floor(e.y),w:1,h:1})},function(t,e,n,o){n[o]=t,kt.set(r)},function(t){i=t,n(0,i)}]}class me extends xt{constructor(t){super(),gt(this,t,pe,he,l,{})}}const $e=wt({message:"",timeout:{}});function ye(){var t;t="",$e.update((e=>(e.message=t,e.timeout&&clearTimeout(e.timeout),t&&(e.timeput=setInterval(ye,5e3)),e)))}function ge(t){const e=t-1;return e*e*e+1}function xe(t,{delay:n=0,duration:o=400,easing:r=e}){const i=+getComputedStyle(t).opacity;return{delay:n,duration:o,easing:r,css:t=>"opacity: "+t*i}}function be(t,{delay:e=0,duration:n=400,easing:o=ge,x:r=0,y:i=0,opacity:s=0}){const l=getComputedStyle(t),c=+l.opacity,u="none"===l.transform?"":l.transform,a=c*(1-s);return{delay:e,duration:n,easing:o,css:(t,e)=>`\n\t\t\ttransform: ${u} translate(${(1-t)*r}px, ${(1-t)*i}px);\n\t\t\topacity: ${c-a*e}`}}function we(t){let e,n,o,r,i,s,l,c,u,a=t[0].message+"";return{c(){e=k("div"),n=k("span"),o=M(a),r=_(),i=k("button"),i.innerHTML='<img alt="Close Error" title="Close Error" src="https://icongr.am/feather/x.svg?size=16&amp;color=FFFFFF"/>',X(n,"class",""),X(i,"class","button clear icon-only"),X(e,"class","bg-error text-white flex-container svelte-5g87iy")},m(t,s){b(t,e,s),x(e,n),x(n,o),x(e,r),x(e,i),l=!0,c||(u=E(i,"click",ye),c=!0)},p(t,e){(!l||1&e)&&a!==(a=t[0].message+"")&&Y(o,a)},i(t){l||(K((()=>{s||(s=dt(e,be,{y:-100,opacity:1},!0)),s.run(1)})),l=!0)},o(t){s||(s=dt(e,be,{y:-100,opacity:1},!1)),s.run(0),l=!1},d(t){t&&w(e),t&&s&&s.end(),c=!1,u()}}}function ve(t){let e,n,o=t[0].message&&we(t);return{c(){o&&o.c(),e=M("")},m(t,r){o&&o.m(t,r),b(t,e,r),n=!0},p(t,[n]){t[0].message?o?(o.p(t,n),1&n&&ct(o,1)):(o=we(t),o.c(),ct(o,1),o.m(e.parentNode,e)):o&&(st(),ut(o,1,1,(()=>{o=null})),lt())},i(t){n||(ct(o),n=!0)},o(t){ut(o),n=!1},d(t){o&&o.d(t),t&&w(e)}}}function ke(t,e,n){let o;return u(t,$e,(t=>n(0,o=t))),[o]}class Me extends xt{constructor(t){super(),gt(this,t,ke,ve,l,{})}}const _e={};function Ee(t){let e,n,o,r,i,s;const l=t[5].default,c=a(l,t,t[4],null);return{c(){e=_(),n=k("div"),c&&c.c(),R(n,"top",t[1]+"px"),R(n,"left",t[0]+"px"),X(n,"class","svelte-1rogqys")},m(o,l){b(o,e,l),b(o,n,l),c&&c.m(n,null),t[6](n),r=!0,i||(s=E(document.body,"click",t[3]),i=!0)},p(t,[e]){c&&c.p&&16&e&&f(c,l,t,t[4],e,null,null),(!r||2&e)&&R(n,"top",t[1]+"px"),(!r||1&e)&&R(n,"left",t[0]+"px")},i(t){r||(ct(c,t),K((()=>{o||(o=dt(n,xe,{duration:100},!0)),o.run(1)})),r=!0)},o(t){ut(c,t),o||(o=dt(n,xe,{duration:100},!1)),o.run(0),r=!1},d(r){r&&w(e),r&&w(n),c&&c.d(r),t[6](null),r&&o&&o.end(),i=!1,s()}}}function Te(t,e,n){let{$$slots:o={},$$scope:r}=e,{x:i}=e,{y:s}=e;const l=H();let c;return D(_e,{dispatchClick:()=>l("click")}),t.$$set=t=>{"x"in t&&n(0,i=t.x),"y"in t&&n(1,s=t.y),"$$scope"in t&&n(4,r=t.$$scope)},t.$$.update=()=>{7&t.$$.dirty&&(()=>{if(!c)return;const t=c.getBoundingClientRect();n(0,i=Math.min(window.innerWidth-t.width,i)),s>window.innerHeight-t.height&&n(1,s-=t.height)})()},[i,s,c,function(t){t.target===c||c.contains(t.target)||l("clickoutside")},r,o,function(t){B[t?"unshift":"push"]((()=>{c=t,n(2,c)}))}]}class Xe extends xt{constructor(t){super(),gt(this,t,Te,Ee,l,{x:0,y:1})}}function Ye(t){let e;const n=t[4].default,o=a(n,t,t[3],null);return{c(){o&&o.c()},m(t,n){o&&o.m(t,n),e=!0},p(t,e){o&&o.p&&8&e&&f(o,n,t,t[3],e,null,null)},i(t){e||(ct(o,t),e=!0)},o(t){ut(o,t),e=!1},d(t){o&&o.d(t)}}}function Re(e){let n;return{c(){n=M(e[1])},m(t,e){b(t,n,e)},p(t,e){2&e&&Y(n,t[1])},i:t,o:t,d(t){t&&w(n)}}}function Se(t){let e,n,o,r,i,s;const l=[Re,Ye],c=[];function u(t,e){return t[1]?0:1}return n=u(t),o=c[n]=l[n](t),{c(){e=k("div"),o.c(),X(e,"class","svelte-11hdt5k"),S(e,"disabled",t[0])},m(o,l){b(o,e,l),c[n].m(e,null),r=!0,i||(s=E(e,"click",t[2]),i=!0)},p(t,[r]){let i=n;n=u(t),n===i?c[n].p(t,r):(st(),ut(c[i],1,1,(()=>{c[i]=null})),lt(),o=c[n],o?o.p(t,r):(o=c[n]=l[n](t),o.c()),ct(o,1),o.m(e,null)),1&r&&S(e,"disabled",t[0])},i(t){r||(ct(o),r=!0)},o(t){ut(o),r=!1},d(t){t&&w(e),c[n].d(),i=!1,s()}}}function Ce(t,e,n){let{$$slots:o={},$$scope:r}=e,{isDisabled:i=!1}=e,{text:s=""}=e;const l=H(),{dispatchClick:c}=I(_e);return t.$$set=t=>{"isDisabled"in t&&n(0,i=t.isDisabled),"text"in t&&n(1,s=t.text),"$$scope"in t&&n(3,r=t.$$scope)},[i,s,t=>{i||(l("click"),c())},r,o]}class Fe extends xt{constructor(t){super(),gt(this,t,Ce,Se,l,{isDisabled:0,text:1})}}function Oe(t){let e,o;const r=[t[0]];let i={$$slots:{default:[Ae]},$$scope:{ctx:t}};for(let t=0;t<r.length;t+=1)i=n(i,r[t]);return e=new Xe({props:i}),e.$on("click",t[3]),e.$on("clickoutside",t[3]),{c(){pt(e.$$.fragment)},m(t,n){mt(e,t,n),o=!0},p(t,n){const o=1&n?function(t,e){const n={},o={},r={$$scope:1};let i=t.length;for(;i--;){const s=t[i],l=e[i];if(l){for(const t in s)t in l||(o[t]=1);for(const t in l)r[t]||(n[t]=l[t],r[t]=1);t[i]=l}else for(const t in s)r[t]=1}for(const t in o)t in n||(n[t]=void 0);return n}(r,[(i=t[0],"object"==typeof i&&null!==i?i:{})]):{};var i;256&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){o||(ct(e.$$.fragment,t),o=!0)},o(t){ut(e.$$.fragment,t),o=!1},d(t){$t(e,t)}}}function Ae(e){let n,o;return n=new Fe({props:{text:"Reset Camera"}}),n.$on("click",e[4]),{c(){pt(n.$$.fragment)},m(t,e){mt(n,t,e),o=!0},p:t,i(t){o||(ct(n.$$.fragment,t),o=!0)},o(t){ut(n.$$.fragment,t),o=!1},d(t){$t(n,t)}}}function je(t){let e,n,o,r,i=t[1]&&Oe(t);return{c(){i&&i.c(),e=_()},m(s,l){i&&i.m(s,l),b(s,e,l),n=!0,o||(r=E(document.body,"contextmenu",T(t[2])),o=!0)},p(t,[n]){t[1]?i?(i.p(t,n),2&n&&ct(i,1)):(i=Oe(t),i.c(),ct(i,1),i.m(e.parentNode,e)):i&&(st(),ut(i,1,1,(()=>{i=null})),lt())},i(t){n||(ct(i),n=!0)},o(t){ut(i),n=!1},d(t){i&&i.d(t),t&&w(e),o=!1,r()}}}function Le(t,e,n){let o,r,i;u(t,_t,(t=>n(5,o=t))),u(t,Mt,(t=>n(6,r=t))),u(t,St,(t=>n(7,i=t)));let s={x:0,y:0},l=!1;return[s,l,async function(t){l&&(n(1,l=!1),await new Promise((t=>setTimeout(t,100)))),n(0,s={x:o.screenX,y:o.screenY}),1!=r&&n(1,l=!0)},function(){n(1,l=!1)},function(){h(St,i.dx=0,i),h(St,i.dy=0,i)}]}class Pe extends xt{constructor(t){super(),gt(this,t,Le,je,l,{})}}function Ne(e){let n,o,r,i,s,l;return n=new Me({}),r=new me({}),s=new Pe({}),{c(){pt(n.$$.fragment),o=_(),pt(r.$$.fragment),i=_(),pt(s.$$.fragment)},m(t,e){mt(n,t,e),b(t,o,e),mt(r,t,e),b(t,i,e),mt(s,t,e),l=!0},p:t,i(t){l||(ct(n.$$.fragment,t),ct(r.$$.fragment,t),ct(s.$$.fragment,t),l=!0)},o(t){ut(n.$$.fragment,t),ut(r.$$.fragment,t),ut(s.$$.fragment,t),l=!1},d(t){$t(n,t),t&&w(o),$t(r,t),t&&w(i),$t(s,t)}}}return new class extends xt{constructor(t){super(),gt(this,t,null,Ne,l,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
